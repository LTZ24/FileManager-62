# ==============================================================================
# Security Configuration - Data Management System
# ==============================================================================

# Enable Rewrite Engine
RewriteEngine On
# RewriteBase is intentionally omitted â€” Apache auto-detects the correct
# base from the .htaccess directory.  This works on both localhost (subfolder)
# and hosting (domain root) without any manual change.

# Remove .php extension from URLs (for GET requests only, to avoid POST redirect issues)
# If the request is for a file that exists, serve it directly
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Add .php extension if file exists
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L]

# Redirect .php URLs to non-.php URLs (GET only - POST should not be redirected)
RewriteCond %{REQUEST_METHOD} GET [NC]
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
RewriteRule ^ %1 [R=301,L]

# Remove trailing slash from URLs (except directories)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# Disable Directory Listing
Options -Indexes

# Prevent access to sensitive files
<FilesMatch "^(config\.php|\.env|\.git|composer\.json|composer\.lock)$">
    Require all denied
</FilesMatch>

# Block access to hidden files
<FilesMatch "^\.|\.bak$|\.backup$|\.swp$|\.old$|\.sql$|\.log$">
    Require all denied
</FilesMatch>

# Block accidental exposure of Google Service Account JSON keys
<FilesMatch "(?i)(service-account|service_account|google-service-account|google-oauth-token|credentials|smkn-62-database).*\.json$">
    Require all denied
</FilesMatch>

# Custom Error Pages (hide server info)
ErrorDocument 400 /error.php?code=400
ErrorDocument 401 /error.php?code=401
ErrorDocument 403 /error.php?code=403
ErrorDocument 404 /error.php?code=404
ErrorDocument 500 /error.php?code=500

# Limit file upload size (100MB)
php_value upload_max_filesize 100M
php_value post_max_size 105M
php_value max_execution_time 300
php_value max_input_time 300

# Session security
php_flag session.cookie_httponly on
php_value session.gc_maxlifetime 1800


